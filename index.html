<!-- VR Cube Room + Controller Debugger + Ball Shooter (Meta Quest ready) -->
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Controller Demo (Cube Room)</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- We'll use A-Frame's text component for floating debug -->
    <script>
      // Controller Debugger Component
      AFRAME.registerComponent('controller-debug', {
        schema: { hand: { type: 'string', default: 'right' } },
        init: function () {
          this.statusText = '';
          this.textEl = document.getElementById(this.data.hand + '-controller-debug');
          this.listen = this.listen.bind(this);

          // List of Quest events (can extend if needed)
          this.events = [
            'triggerdown', 'triggerup', 'gripdown', 'gripup',
            'thumbstickdown', 'thumbstickup', 'abuttondown', 'abuttonup',
            'bbuttondown', 'bbuttonup', 'xbuttondown', 'xbuttonup',
            'ybuttondown', 'ybuttonup', 'thumbstickmoved'
          ];
          this.events.forEach(e => this.el.addEventListener(e, this.listen));
        },
        listen: function (evt) {
          // Build a status string
          let str = `[${this.data.hand}] Event: ${evt.type}`;
          if (evt.detail && evt.detail.x !== undefined && evt.detail.y !== undefined) {
            str += `\nThumbstick: x=${evt.detail.x.toFixed(2)}, y=${evt.detail.y.toFixed(2)}`;
          }
          this.textEl.setAttribute('value', str);
        }
      });

      // Ball Shooter Component (attach to right controller)
      AFRAME.registerComponent('ball-shooter', {
        init: function () {
          this.el.addEventListener('triggerdown', () => {
            // Create a sphere in front of the camera rig
            const scene = this.el.sceneEl;
            const camera = scene.querySelector('[camera]');
            const camObj = camera.object3D;
            const pos = new THREE.Vector3();
            camObj.getWorldPosition(pos);
            const dir = new THREE.Vector3();
            camObj.getWorldDirection(dir);

            // Ball entity
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', 0.08);
            ball.setAttribute('color', '#FCD303');
            ball.setAttribute('position', `${pos.x + dir.x * 0.4} ${pos.y + dir.y * 0.4} ${pos.z + dir.z * 0.4}`);
            ball.setAttribute('velocity', `${dir.x * 3} ${dir.y * 3} ${dir.z * 3}`); // shoot forward
            ball.setAttribute('dynamic-body', 'mass:0.4; shape:sphere;');
            ball.setAttribute('shadow', '');

            scene.appendChild(ball);

            // Remove after 5s to avoid clutter
            setTimeout(() => ball.parentNode && ball.parentNode.removeChild(ball), 5000);
          });
        }
      });
    </script>
    <!-- Physics (optional, but fun for balls) -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  </head>
  <body>
    <a-scene physics="gravity: -9.8" shadow="type: pcfsoft">
      <!-- VR Rig with controllers -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-entity camera look-controls wasd-controls position="0 0 0"></a-entity>
        <!-- Left controller with debug -->
        <a-entity id="leftHand" meta-touch-controls="hand: left"
                  controller-debug="hand: left"></a-entity>
        <!-- Right controller with debug & shooter -->
        <a-entity id="rightHand" meta-touch-controls="hand: right"
                  controller-debug="hand: right" ball-shooter></a-entity>
      </a-entity>

      <!-- Floating debug displays -->
      <a-entity id="left-controller-debug"
                text="value: [left]; width: 2; color: #0ff"
                position="-1.3 2.6 -1.5" scale="1 1 1"></a-entity>
      <a-entity id="right-controller-debug"
                text="value: [right]; width: 2; color: #ff0"
                position="1.3 2.6 -1.5" scale="1 1 1"></a-entity>

      <!-- Cube Room (6 faces) -->
      <a-plane position="0 0 0" rotation="-90 0 0" width="4" height="4" color="#b0e57c" static-body></a-plane>
      <a-plane position="0 3 0" rotation="90 0 0" width="4" height="4" color="#98d4f7" static-body></a-plane>
      <a-plane position="0 1.5 -2" rotation="0 0 0" width="4" height="3" color="#f7b05b" static-body></a-plane>
      <a-plane position="0 1.5 2" rotation="0 180 0" width="4" height="3" color="#e868a1" static-body></a-plane>
      <a-plane position="-2 1.5 0" rotation="0 90 0" width="4" height="3" color="#a280e9" static-body></a-plane>
      <a-plane position="2 1.5 0" rotation="0 -90 0" width="4" height="3" color="#f55c47" static-body></a-plane>
    </a-scene>
  </body>
</html>
