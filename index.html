<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Space Exploration</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-controller-cursor-component@1.0.1/dist/aframe-controller-cursor-component.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }
        #ui {
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-family: 'Arial', sans-serif;
            z-index: 100;
            pointer-events: none;
            text-shadow: 0 0 5px #000;
        }
        #title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #4fc3f7;
        }
        #instructions {
            font-size: 16px;
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="title">VR SPACE EXPLORATION</div>
        <div id="instructions">Use controller joysticks to navigate. Point and grab to interact with objects.</div>
    </div>
    
    <a-scene 
        renderer="antialias: true; colorManagement: true; sortObjects: true"
        background="color: #000022"
        vr-mode-ui="enabled: true"
        device-orientation-permission-ui="enabled: true">
        
        <!-- Camera with controller support -->
        <a-entity id="rig" movement-controls="fly: true; speed: 0.2">
            <a-entity id="camera" camera="active: true" position="0 1.6 0" look-controls="pointerLockEnabled: false">
                <!-- Controller cursors -->
                <a-entity laser-controls="hand: left" raycaster="objects: .interactable"></a-entity>
                <a-entity laser-controls="hand: right" raycaster="objects: .interactable"></a-entity>
            </a-entity>
        </a-entity>
        
        <!-- Spaceship -->
        <a-entity id="spaceship" position="0 0 -5" rotation="0 0 0">
            <!-- Cockpit -->
            <a-box position="0 0 0" width="0.8" height="0.4" depth="1.5" color="#333333" 
                   material="metalness: 0.8; roughness: 0.2"></a-box>
            
            <!-- Wings -->
            <a-box position="-0.6 0 -0.2" width="0.4" height="0.1" depth="0.8" color="#444444" 
                   rotation="0 0 10"></a-box>
            <a-box position="0.6 0 -0.2" width="0.4" height="0.1" depth="0.8" color="#444444" 
                   rotation="0 0 -10"></a-box>
            
            <!-- Engines -->
            <a-cylinder position="-0.3 -0.1 -0.7" radius="0.1" height="0.2" color="#555555" 
                        rotation="90 0 0"></a-cylinder>
            <a-cylinder position="0.3 -0.1 -0.7" radius="0.1" height="0.2" color="#555555" 
                        rotation="90 0 0"></a-cylinder>
            
            <!-- Engine glow -->
            <a-entity position="-0.3 -0.2 -0.7">
                <a-light type="point" color="#4fc3f7" intensity="0.5" distance="1"></a-light>
                <a-ring radius-inner="0.05" radius-outer="0.15" color="#4fc3f7" 
                        material="shader: flat; opacity: 0.7" rotation="-90 0 0"></a-ring>
            </a-entity>
            <a-entity position="0.3 -0.2 -0.7">
                <a-light type="point" color="#4fc3f7" intensity="0.5" distance="1"></a-light>
                <a-ring radius-inner="0.05" radius-outer="0.15" color="#4fc3f7" 
                        material="shader: flat; opacity: 0.7" rotation="-90 0 0"></a-ring>
            </a-entity>
            
            <!-- Cockpit glass -->
            <a-box position="0 0.1 0.3" width="0.6" height="0.3" depth="0.1" color="#a0d8ef" 
                   material="transparent: true; opacity: 0.4"></a-box>
        </a-entity>
        
        <!-- Procedurally generated stars -->
        <a-entity id="stars"></a-entity>
        
        <!-- Distant planets -->
        <a-sphere position="15 5 -20" radius="4" color="#8e44ad" 
                  material="shader: flat"></a-sphere>
        <a-sphere position="-20 -8 -30" radius="6" color="#2980b9" 
                  material="shader: flat"></a-sphere>
        <a-sphere position="0 15 -40" radius="3" color="#c0392b" 
                  material="shader: flat"></a-sphere>
        
        <!-- Ambient light -->
        <a-light type="ambient" color="#333344"></a-light>
        
        <!-- Directional light (sun) -->
        <a-light type="directional" color="#ffffff" intensity="0.5" position="10 20 10"></a-light>
    </a-scene>

    <script>
        // Procedurally generate stars
        function generateStars() {
            const starsEntity = document.getElementById('stars');
            const starCount = 2000;
            const spread = 100;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('a-entity');
                
                // Random position
                const x = (Math.random() - 0.5) * spread * 2;
                const y = (Math.random() - 0.5) * spread * 2;
                const z = (Math.random() - 0.5) * spread * 2 - spread;
                
                // Random size and color
                const size = Math.random() * 0.1 + 0.02;
                const colors = ['#ffffff', '#ffffcc', '#ffd700', '#ffaa33'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                star.setAttribute('geometry', {
                    primitive: 'sphere',
                    radius: size
                });
                
                star.setAttribute('material', {
                    color: color,
                    shader: 'flat'
                });
                
                star.setAttribute('position', `${x} ${y} ${z}`);
                
                // Twinkle effect
                if (Math.random() > 0.7) {
                    star.setAttribute('animation', {
                        property: 'components.material.material.opacity',
                        from: 0.2,
                        to: 1,
                        dur: 2000 + Math.random() * 3000,
                        dir: 'alternate',
                        loop: true,
                        easing: 'easeInOutSine'
                    });
                }
                
                starsEntity.appendChild(star);
            }
        }
        
        // Spaceship controls
        function setupSpaceshipControls() {
            const spaceship = document.getElementById('spaceship');
            const rig = document.getElementById('rig');
            
            // Movement variables
            let velocity = new THREE.Vector3();
            let rotationSpeed = 0.02;
            let maxSpeed = 0.1;
            
            // Handle controller input
            document.addEventListener('controllerconnected', function(evt) {
                const controller = evt.detail.component;
                controller.addEventListener('axismove', function(e) {
                    const axes = e.detail.axis;
                    if (axes.length >= 2) {
                        // Left joystick - rotation
                        const x = axes[0];
                        const y = axes[1];
                        
                        // Apply rotation to spaceship
                        if (Math.abs(x) > 0.1) {
                            spaceship.object3D.rotation.y -= x * rotationSpeed;
                        }
                        
                        // Apply forward/backward movement
                        if (Math.abs(y) > 0.1) {
                            // Calculate forward direction based on spaceship rotation
                            const direction = new THREE.Vector3(0, 0, -1);
                            direction.applyQuaternion(spaceship.object3D.quaternion);
                            
                            // Apply velocity in that direction
                            velocity.add(direction.multiplyScalar(-y * 0.01));
                            
                            // Clamp velocity
                            if (velocity.length() > maxSpeed) {
                                velocity.normalize().multiplyScalar(maxSpeed);
                            }
                        }
                    }
                });
            });
            
            // Apply movement
            rig.addEventListener('componentchanged', function(evt) {
                if (evt.detail.name === 'position') {
                    // Apply velocity to rig position
                    const position = rig.getAttribute('position');
                    rig.setAttribute('position', {
                        x: position.x + velocity.x,
                        y: position.y + velocity.y,
                        z: position.z + velocity.z
                    });
                    
                    // Apply spaceship position relative to rig
                    spaceship.setAttribute('position', {
                        x: 0,
                        y: 0,
                        z: -5
                    });
                    
                    // Slow down over time (damping)
                    velocity.multiplyScalar(0.95);
                }
            });
        }
        
        // Initialize when scene is loaded
        document.querySelector('a-scene').addEventListener('loaded', function() {
            generateStars();
            setupSpaceshipControls();
            
            // Add some interactive objects
            const scene = document.querySelector('a-scene');
            
            // Create some asteroids
            for (let i = 0; i < 15; i++) {
                const asteroid = document.createElement('a-entity');
                const size = Math.random() * 0.5 + 0.2;
                const distance = 10 + Math.random() * 30;
                const angle = Math.random() * Math.PI * 2;
                
                asteroid.setAttribute('geometry', {
                    primitive: 'sphere',
                    radius: size
                });
                
                asteroid.setAttribute('material', {
                    color: '#7f8c8d',
                    metalness: 0.8,
                    roughness: 0.5
                });
                
                asteroid.setAttribute('position', {
                    x: Math.cos(angle) * distance,
                    y: (Math.random() - 0.5) * 10,
                    z: Math.sin(angle) * distance - 10
                });
                
                asteroid.setAttribute('class', 'interactable');
                
                // Rotation animation
                asteroid.setAttribute('animation', {
                    property: 'rotation',
                    to: {x: 360, y: 360, z: 360},
                    dur: 10000 + Math.random() * 20000,
                    loop: true,
                    easing: 'linear'
                });
                
                scene.appendChild(asteroid);
            }
        });
    </script>
</body>
</html>
