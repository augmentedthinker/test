<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR Environment and Controller Test</title>
    <!-- A-Frame library for WebXR development -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <!-- A-Frame Environment Component for easy scene creation -->
    <script src="https://unpkg.com/aframe-environment-component@1.5.3/dist/aframe-environment-component.min.js"></script>
    <!-- A-Frame Extras for movement controls -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        /* Ensure the canvas fills the screen */
        .a-canvas {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <a-scene
        webxr="requiredFeatures: local-floor; optionalFeatures: hit-test;"
        renderer="colorManagement: true; antialias: true;"
        cursor="rayOrigin: mouse"
    >
        <!-- Assets section (currently empty, but good practice for future models/textures) -->
        <a-assets>
            <!-- No assets needed for this basic setup, but this is where they would go -->
        </a-assets>

        <!-- Player Camera Rig: Handles user movement and head tracking -->
        <!--
            'movement-controls': Enables locomotion using thumbsticks or WASD keys.
            'speed': Sets the movement speed.
            'position': Initial position of the player in the scene.
        -->
        <a-entity id="playerRig" movement-controls="speed: 0.1" position="0 1.6 0">
            <!-- Camera: Represents the user's head and view -->
            <!--
                'look-controls': Enables head rotation for looking around.
            -->
            <a-entity camera look-controls></a-entity>

            <!-- Left VR Controller: Visual model, raycaster for interaction, and laser pointer -->
            <!--
                'meta-touch-controls': Loads the Quest controller model and handles its input.
                'hand: left': Specifies it's the left controller.
                'raycaster': Enables raycasting from the controller for interactions.
                    'objects: .clickable': Only objects with the 'clickable' class will be detected.
                    'far: 10': The maximum distance the raycast will extend (10 meters).
                'line': Visualizes the raycaster as a line (laser pointer).
                    'color': Color of the laser pointer.
                    'opacity': Transparency of the laser pointer.
            -->
            <a-entity
                meta-touch-controls="hand: left"
                raycaster="objects: .clickable; far: 10;"
                line="color: blue; opacity: 0.7"
            ></a-entity>

            <!-- Right VR Controller: Same setup as the left controller -->
            <a-entity
                meta-touch-controls="hand: right"
                raycaster="objects: .clickable; far: 10;"
                line="color: red; opacity: 0.7"
            ></a-entity>
        </a-entity>

        <!-- Environment: Created using the aframe-environment-component -->
        <!--
            'preset: forest': Uses a built-in forest theme.
            'dressing': Adds decorative objects like trees.
            'dressingAmount': Number of decorative objects.
            'groundColor', 'groundColor2': Colors for the ground texture.
        -->
        <a-entity
            environment="preset: forest; dressing: 50; dressingAmount: 200; groundColor: #6B8E23; groundColor2: #228B22;"
        ></a-entity>

        <!-- Test Object: A box that changes color when clicked -->
        <!--
            'id': Unique identifier for the object.
            'position': Placement in the 3D scene (X Y Z).
            'rotation': Initial rotation (degrees).
            'color': Initial color of the box.
            'scale': Size of the box.
            'class="clickable"': Marks the object as interactable by the raycaster.
            'change-color-on-click': Custom component to handle color change on click.
        -->
        <a-box
            id="testObject"
            position="0 1 -3"
            rotation="0 45 0"
            color="#4CC3D9"
            scale="0.5 0.5 0.5"
            class="clickable"
            change-color-on-click
        ></a-box>

        <!-- A-Frame component to change the color of an entity on click -->
        <script>
            AFRAME.registerComponent('change-color-on-click', {
                init: function () {
                    var el = this.el; // Reference to the entity this component is attached to

                    // Add an event listener for the 'click' event
                    el.addEventListener('click', function () {
                        // Generate a random color in hexadecimal format
                        var randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);

                        // Set the entity's color attribute to the new random color
                        // This updates the material of the box
                        el.setAttribute('color', randomColor);

                        console.log('Box clicked! New color: ' + randomColor);
                    });
                }
            });
        </script>
    </a-scene>
</body>
</html>
