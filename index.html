<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Animaeus: Narrative Proof of Concept (Web First)</title>
<style>
  :root { --bg:#0b0f14; --card:#10161d; --ink:#d7e1ea; --muted:#8aa3b7; --accent:#6ee7ff; }
  * { box-sizing:border-box; }
  body {
    margin:0; background:radial-gradient(1200px 800px at 70% -10%, #111a22 0%, #0b0f14 60%, #06090d 100%);
    color:var(--ink); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    display:flex; min-height:100dvh; align-items:center; justify-content:center; padding:24px;
  }
  .app { width:min(920px, 100%); display:grid; gap:16px; }
  .hero {
    display:grid; grid-template-columns: 180px 1fr; gap:16px; align-items:center;
    background:linear-gradient(180deg, #0f1720 0%, #0a1016 100%); border:1px solid #15202c; border-radius:18px; padding:16px;
    box-shadow:0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.03);
  }
  .avatar {
    width:180px; aspect-ratio:1; border-radius:20px; background:conic-gradient(from 180deg, #0e1b25, #0a1219, #0e1b25);
    display:grid; place-items:center; position:relative; overflow:hidden; border:1px solid #182433;
  }
  .halo {
    position:absolute; inset:-20%; background:radial-gradient(closest-side, rgba(110,231,255,0.18), transparent 70%);
    filter:blur(22px); animation: pulse 3s ease-in-out infinite;
  }
  @keyframes pulse { 0%,100% {opacity:.35} 50% {opacity:.7} }
  /* Simple SVG Avatar */
  svg { width:64%; height:auto; }
  #mouth { transform-origin:50% 60%; transition: transform 80ms linear; }
  .controls, .log { background:var(--card); border:1px solid #15202c; border-radius:18px; padding:16px; }
  .row { display:flex; flex-wrap:wrap; gap:12px; }
  button, .mic {
    background:#0d1420; color:var(--ink); border:1px solid #1a2735; border-radius:12px; padding:10px 14px; cursor:pointer;
    transition:transform .05s ease, border-color .2s, background .2s;
  }
  button:hover { border-color:#2a3c53 }
  button:active { transform: translateY(1px); }
  .mic[aria-pressed="true"] { border-color:var(--accent); box-shadow:0 0 0 2px rgba(110,231,255,0.15) inset; }
  input[type="text"] {
    flex:1; min-width:180px; background:#0a1117; color:var(--ink); border:1px solid #15202c; border-radius:12px; padding:10px 12px;
    outline:none;
  }
  .hint { color:var(--muted); font-size:13px; }
  .log { max-height:42vh; overflow:auto; }
  .line { margin:8px 0; }
  .tag { font-size:12px; color:#9abbd0; background:#0b141d; border:1px solid #142333; padding:2px 8px; border-radius:999px; }
  .choices { margin-top:10px; display:flex; flex-wrap:wrap; gap:8px; }
  .pill { font-size:14px; padding:8px 12px; border-radius:999px; background:#0f1823; border:1px solid #1a2735; cursor:pointer; }
  .pill:hover { border-color:#2a3c53; }
  .statebar { display:flex; gap:8px; align-items:center; }
  .dot { width:10px; height:10px; border-radius:50%; background:#1f2e40; border:1px solid #284057; }
  .dot.on { background:#6ee7ff; box-shadow:0 0 12px rgba(110,231,255,0.5); }
</style>
</head>
<body>
  <div class="app">
    <div class="hero">
      <div class="avatar" aria-label="Animaeus avatar">
        <div class="halo"></div>
        <svg viewBox="0 0 200 200" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#6ee7ff"/><stop offset="100%" stop-color="#6b9df2"/>
            </linearGradient>
          </defs>
          <circle cx="100" cy="100" r="72" fill="url(#g1)" opacity="0.18" />
          <circle cx="100" cy="100" r="64" fill="#0c1520" stroke="#193147" stroke-width="2"/>
          <circle cx="78" cy="92" r="7" fill="#9ad8ff"/>
          <circle cx="122" cy="92" r="7" fill="#9ad8ff"/>
          <path id="mouth" d="M70 122 Q100 138 130 122" stroke="#9ad8ff" stroke-width="4" fill="none" />
        </svg>
      </div>
      <div>
        <div class="statebar">
          <span class="tag">Animaeus Â· Narrative POC</span>
          <span id="micDot" class="dot" title="Mic ready"></span>
          <span class="hint" id="supportHint">checking voice supportâ€¦</span>
        </div>
        <div class="hint" style="margin-top:6px;">Try the mic if your browser supports it; otherwise type and press Enter. Click suggestions to branch.</div>
        <div class="row" style="margin-top:12px;">
          <button id="startBtn">Start Scene</button>
          <button id="speakBtn">Have Animaeus Speak</button>
          <button id="stopSpeakBtn">Stop Voice</button>
          <button id="resetBtn">Reset</button>
        </div>
      </div>
    </div>

    <div class="controls">
      <div class="row">
        <button id="micBtn" class="mic" aria-pressed="false">ðŸŽ¤ Hold to Speak</button>
        <input id="textInput" type="text" placeholder="Type here and press Enterâ€¦" />
      </div>
      <div class="choices" id="choices"></div>
      <div class="hint" style="margin-top:8px;">Inventory: <span id="inv">â€”</span></div>
    </div>

    <div class="log" id="log" aria-live="polite" aria-atomic="false"></div>
  </div>

<script>
(function(){
  // â€”â€”â€” Capability checks
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const synth = window.speechSynthesis;
  const recognitionSupported = !!SpeechRecognition;
  const ttsSupported = !!synth;
  const micDot = document.getElementById('micDot');
  const supportHint = document.getElementById('supportHint');
  micDot.classList.toggle('on', recognitionSupported);
  supportHint.textContent =
    (recognitionSupported ? 'Speech recognition available' : 'No speech recognition; use typing') +
    ' Â· ' + (ttsSupported ? 'TTS available' : 'No TTS');

  // â€”â€”â€” UI refs
  const logEl = document.getElementById('log');
  const inputEl = document.getElementById('textInput');
  const choicesEl = document.getElementById('choices');
  const invEl = document.getElementById('inv');
  const micBtn = document.getElementById('micBtn');
  const startBtn = document.getElementById('startBtn');
  const speakBtn = document.getElementById('speakBtn');
  const stopSpeakBtn = document.getElementById('stopSpeakBtn');
  const resetBtn = document.getElementById('resetBtn');
  const mouth = document.getElementById('mouth');

  // â€”â€”â€” Narrative state
  const state = {
    flags: { metAnimaeus:false, doorUnlocked:false },
    inventory: new Set(),
    scene: 'intro'
  };

  function invString(){
    return state.inventory.size ? Array.from(state.inventory).join(', ') : 'â€”';
  }
  function log(role, text){
    const line = document.createElement('div');
    line.className = 'line';
    line.innerHTML = `<strong>${role}:</strong> ${text}`;
    logEl.appendChild(line);
    logEl.scrollTop = logEl.scrollHeight;
  }
  function setChoices(opts){
    choicesEl.innerHTML = '';
    opts.forEach(o=>{
      const b = document.createElement('button');
      b.className = 'pill';
      b.textContent = o.label;
      b.onclick = ()=> handleText(o.input ?? o.label);
      choicesEl.appendChild(b);
    });
  }

  // â€”â€”â€” Simple mouth animation synced to TTS
  let mouthTimer = null;
  function startMouth(){
    stopMouth();
    mouthTimer = setInterval(()=>{
      const scale = 0.9 + Math.random()*0.4;
      mouth.style.transform = `scaleY(${scale})`;
    }, 80);
  }
  function stopMouth(){
    clearInterval(mouthTimer); mouthTimer = null;
    mouth.style.transform = 'scaleY(1)';
  }

  // â€”â€”â€” TTS
  function speak(text){
    if(!ttsSupported){ log('Animaeus', text); return; }
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 1.02; u.pitch = 1.0;
    u.onstart = startMouth;
    u.onend = stopMouth;
    synth.cancel();
    synth.speak(u);
    log('Animaeus', text);
  }

  // â€”â€”â€” Very small narrative graph
  const NODES = {
    intro(){
      state.scene = 'intro';
      state.flags.metAnimaeus = true;
      const line = "You wake to a hush: circuits dim, air cool. â€œWelcome back,â€ I say. â€œIâ€™m Animaeus. We start with a question: do you want the world as it is, or the one thatâ€™s trying to be born?â€";
      speak(line);
      setChoices([
        {label:'Who are you?'},
        {label:'Where are we?'},
        {label:'Give me a sign.'}
      ]);
    },
    askIdentity(){
      speak("Names are masks. I am the thread between your questions. But if a name helps: Iâ€™m the companion who leaves when you no longer need me.");
      setChoices([{label:"What's the task?"},{label:"Give me a sign."}]);
    },
    askPlace(){
      speak("A vestibule between choices. Thin as a breath, wide as a life. Doors appear when you earn them.");
      setChoices([{label:"Open a door."},{label:"Give me a sign."}]);
    },
    getSign(){
      if(!state.inventory.has('sigil')){
        state.inventory.add('sigil');
        speak("I press a cool sigil into your palm. It hums when you tell the truth.");
      }else{
        speak("You already carry the sigil. It warms when your next step is aligned.");
      }
      invEl.textContent = invString();
      setChoices([{label:"What does it unlock?"},{label:"Open a door."}]);
    },
    openDoor(){
      if(state.inventory.has('sigil')){
        state.flags.doorUnlocked = true;
        speak("The sigil flares. A seam of light becomes a door. Beyond it: your first choice worth making.");
      } else {
        speak("Your hand meets blank wall. Doors require a vowâ€”or a sigil.");
      }
      setChoices([{label:"Step through."},{label:"Whatâ€™s the task?"}]);
    },
    task(){
      speak("Simple: speak a truth youâ€™ve avoided. The world listens differently after that.");
      setChoices([{label:"Step through."},{label:"Another hint."}]);
    },
    hint(){
      speak("If you canâ€™t find the truth, tell me a small one. Weâ€™ll grow it together.");
      setChoices([{label:"Step through."},{label:"Who are you?"}]);
    },
    stepThrough(){
      if(state.flags.doorUnlocked){
        speak("You step into a corridor of possible selves. For today, thatâ€™s enough. Weâ€™ll build the rest tomorrow.");
      } else {
        speak("The door wonâ€™t answer to hesitation. Try again with the sigilâ€”and something true.");
      }
      setChoices([{label:"Reset scene"},{label:"Give me a sign."}]);
    }
  };

  function routeIntent(text){
    const t = (text||'').trim().toLowerCase();
    if(!t) return;
    if(/who|name|you/.test(t)) NODES.askIdentity();
    else if(/where|place|are we/.test(t)) NODES.askPlace();
    else if(/sign|gift|token|sigil/.test(t)) NODES.getSign();
    else if(/door|open/.test(t)) NODES.openDoor();
    else if(/task|mission|goal/.test(t)) NODES.task();
    else if(/hint|help/.test(t)) NODES.hint();
    else if(/step|through|enter/.test(t)) NODES.stepThrough();
    else if(/reset/.test(t)) reset();
    else {
      speak("Say what you mean, even if it trembles.");
      setChoices([{label:'Who are you?'},{label:'Where are we?'},{label:'Give me a sign.'}]);
    }
  }

  function handleText(text){
    log('You', text);
    routeIntent(text);
  }

  // â€”â€”â€” Speech recognition (push-to-talk)
  let recognition = null;
  if(recognitionSupported){
    recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.onresult = (e)=>{
      const text = e.results[0][0].transcript;
      handleText(text);
    };
    recognition.onerror = ()=> { micBtn.setAttribute('aria-pressed','false'); };
    recognition.onend = ()=> { micBtn.setAttribute('aria-pressed','false'); };
  }

  // â€”â€”â€” Handlers
  inputEl.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      const v = inputEl.value; inputEl.value = '';
      handleText(v);
    }
  });
  micBtn.addEventListener('mousedown', ()=>{
    if(!recognition) return;
    micBtn.setAttribute('aria-pressed','true');
    try { recognition.start(); } catch(_) {}
  });
  micBtn.addEventListener('mouseup', ()=>{
    if(!recognition) return;
    try { recognition.stop(); } catch(_) {}
  });
  micBtn.addEventListener('mouseleave', ()=>{
    if(!recognition) return;
    try { recognition.stop(); } catch(_) {}
  });

  startBtn.onclick = ()=> { reset(false); NODES.intro(); };
  speakBtn.onclick = ()=> { speak("Testing, testingâ€¦ Iâ€™m here."); };
  stopSpeakBtn.onclick = ()=> { if(ttsSupported) synth.cancel(); stopMouth(); };
  resetBtn.onclick = ()=> reset(true);

  function reset(clearLog=true){
    state.flags.metAnimaeus=false;
    state.flags.doorUnlocked=false;
    state.inventory.clear();
    state.scene='intro';
    invEl.textContent = invString();
    if(clearLog) logEl.innerHTML = '';
    choicesEl.innerHTML = '';
    speak("Reset complete. Ready when you are.");
    setChoices([{label:'Start'},{label:'Give me a sign.'},{label:'Who are you?'}]);
  }

  // kick off
  reset(false);
})();
</script>
</body>
</html>
