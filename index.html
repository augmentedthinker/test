<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Interactive VR Environment - Quest 2</title>
    <meta name="description" content="VR Environment with Hand Controllers for Quest 2">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe-extras.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        #ui-overlay {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
        }
        
        .control-button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .control-button:hover {
            background: #45a049;
        }
        
        .control-button:active {
            background: #3d8b40;
        }
        
        #status {
            margin-top: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- UI Overlay -->
    <div id="ui-overlay">
        <h3>VR Controller</h3>
        <button class="control-button" onclick="spawnObject()">Spawn Cube</button>
        <button class="control-button" onclick="clearObjects()">Clear All</button>
        <button class="control-button" onclick="changeMode()">Change Mode</button>
        <div id="status">Mode: Interactive | Objects: 0</div>
    </div>

    <!-- A-Frame VR Scene -->
    <a-scene
        background="color: #0a0a0a"
        vr-mode-ui="enabled: true"
        device-orientation-permission-ui="enabled: false"
        id="scene">
        
        <!-- Environment -->
        <a-sky color="#0a0a0a"></a-sky>
        <a-plane position="0 0 -4" rotation="-90 0 0" width="8" height="8" color="#1a1a1a" shadow></a-plane>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="2 4 2" color="#ffffff" intensity="0.5" shadow></a-light>
        
        <!-- Camera Rig with Hand Controllers -->
        <a-entity id="cameraRig" position="0 1.6 3">
            <!-- Head/Camera -->
            <a-camera look-controls wasd-controls="enabled: false"></a-camera>
            
            <!-- Left Hand Controller -->
            <a-entity id="leftHand"
                      hand-controls="hand: left; handModelStyle: lowPoly; color: #15AABF"
                      laser-controls="hand: left"
                      raycaster="objects: .interactive; far: 20"
                      line="color: cyan; opacity: 0.5">
            </a-entity>
            
            <!-- Right Hand Controller -->
            <a-entity id="rightHand" 
                      hand-controls="hand: right; handModelStyle: lowPoly; color: #15AABF"
                      laser-controls="hand: right"
                      raycaster="objects: .interactive; far: 20"
                      line="color: cyan; opacity: 0.5">
            </a-entity>
        </a-entity>
        
        <!-- Assets -->
        <a-assets>
            <a-mixin id="interactive-cube" 
                     class="interactive"
                     geometry="primitive: box; width: 0.3; height: 0.3; depth: 0.3"
                     material="color: #FF6B6B; opacity: 0.9; metalness: 0.3; roughness: 0.4"
                     shadow="cast: true; receive: true"
                     animation__rotation="property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear">
            </a-mixin>
            
            <a-mixin id="interactive-sphere"
                     class="interactive"
                     geometry="primitive: sphere; radius: 0.15"
                     material="color: #4ECDC4; opacity: 0.9; metalness: 0.2; roughness: 0.3"
                     shadow="cast: true; receive: true"
                     animation__bounce="property: position; to: 0 0.3 0; dur: 2000; dir: alternate; loop: true; easing: easeInOutSine">
            </a-mixin>
            
            <a-mixin id="interactive-pyramid"
                     class="interactive"
                     geometry="primitive: cone; radiusBottom: 0.2; radiusTop: 0; height: 0.4"
                     material="color: #FFD93D; opacity: 0.9; metalness: 0.1; roughness: 0.5"
                     shadow="cast: true; receive: true"
                     animation__wobble="property: rotation; to: 5 0 5; dur: 1500; dir: alternate; loop: true; easing: easeInOutQuad">
            </a-mixin>
        </a-assets>
        
        <!-- Interactive Objects Container -->
        <a-entity id="objects-container"></a-entity>
        
        <!-- Sample Interactive Objects -->
        <a-entity mixin="interactive-cube" 
                  position="-1 1 -2"
                  class="interactive clickable"
                  click-handler>
        </a-entity>
        
        <a-entity mixin="interactive-sphere" 
                  position="0 1.5 -2"
                  class="interactive clickable"
                  click-handler>
        </a-entity>
        
        <a-entity mixin="interactive-pyramid" 
                  position="1 1 -2"
                  class="interactive clickable"
                  click-handler>
        </a-entity>
        
        <!-- UI Panel in 3D Space -->
        <a-entity id="ui-panel" position="0 2.5 -1.5" rotation="-15 0 0">
            <a-plane width="2" height="0.8" color="#222" opacity="0.8" radius="0.1"></a-plane>
            <a-text value="VR Interactive Environment\nUse controllers to point and click objects\nTrigger to interact"
                    position="0 0 0.01" 
                    align="center"
                    color="#fff"
                    width="6">
            </a-text>
        </a-entity>

    </a-scene>

    <script>
        let objectCount = 3;
        let currentMode = 'interactive';
        
        // Register click handler component
        AFRAME.registerComponent('click-handler', {
            init: function () {
                this.el.addEventListener('click', this.onClick.bind(this));
                this.el.addEventListener('mouseenter', this.onMouseEnter.bind(this));
                this.el.addEventListener('mouseleave', this.onMouseLeave.bind(this));
            },
            
            onClick: function (evt) {
                console.log('Object clicked!', this.el);
                
                // Change color on click
                const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#95E1D3', '#F38BA8'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                this.el.setAttribute('material', 'color', randomColor);
                
                // Add click animation
                this.el.setAttribute('animation__click', {
                    property: 'scale',
                    to: '1.3 1.3 1.3',
                    dur: 150,
                    dir: 'alternate',
                    loop: 1
                });
                
                // Play sound (if available)
                this.el.components.sound?.playSound();
                
                updateStatus();
            },
            
            onMouseEnter: function (evt) {
                this.el.setAttribute('animation__hover', {
                    property: 'scale',
                    to: '1.1 1.1 1.1',
                    dur: 200
                });
            },
            
            onMouseLeave: function (evt) {
                this.el.setAttribute('animation__hover', {
                    property: 'scale',
                    to: '1 1 1',
                    dur: 200
                });
            }
        });
        
        function spawnObject() {
            const container = document.getElementById('objects-container');
            const objectTypes = ['interactive-cube', 'interactive-sphere', 'interactive-pyramid'];
            const randomType = objectTypes[Math.floor(Math.random() * objectTypes.length)];
            
            const newObject = document.createElement('a-entity');
            newObject.setAttribute('mixin', randomType);
            newObject.setAttribute('class', 'interactive clickable');
            newObject.setAttribute('click-handler', '');
            
            // Random position around the user
            const x = (Math.random() - 0.5) * 4;
            const y = Math.random() * 2 + 0.5;
            const z = -(Math.random() * 3 + 1);
            
            newObject.setAttribute('position', `${x} ${y} ${z}`);
            
            container.appendChild(newObject);
            objectCount++;
            updateStatus();
        }
        
        function clearObjects() {
            const container = document.getElementById('objects-container');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            objectCount = 3; // Keep the initial 3 objects
            updateStatus();
        }
        
        function changeMode() {
            currentMode = currentMode === 'interactive' ? 'creation' : 'interactive';
            updateStatus();
        }
        
        function updateStatus() {
            document.getElementById('status').textContent = 
                `Mode: ${currentMode} | Objects: ${objectCount}`;
        }
        
        // Initialize
        updateStatus();
        
        // Controller event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('enter-vr', function () {
                console.log('Entered VR mode');
            });
            
            scene.addEventListener('exit-vr', function () {
                console.log('Exited VR mode');
            });
        });
    </script>
