<!--
Project: Tiny Chat MVP (Lane A)
Description: Single-file HTML chatbot UI. Works in two modes:
  - Demo mode (no key): local canned/reflective responses so the page always works.
  - Real mode (HF Router): paste your HF token; calls /v1/chat/completions.

Controls & Keys:
  - Top bar: Mode switch, HF Token (only used in Real mode), Model id, Temperature, System Prompt.
  - Chat box: Enter to send. "Clear" resets the conversation.

Tested:
  - Chrome on Chromebook.
  - GitHub Pages (HTTPS) — required for fetch & clipboard APIs.

Known limitations:
  - If you use Real mode, the token is entered client-side at runtime (not stored in code),
    which is fine for personal testing but not for production.
  - CORS/quotas come from Hugging Face; errors will surface in the UI.
  - No streaming to keep code small.

How to deploy:
  1) Create a repo with this single file named index.html.
  2) Enable GitHub Pages (main branch / root).
  3) Open the Pages URL. Use Demo mode immediately, or switch to Real mode and paste HF token.
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tiny Chat MVP — Lane A</title>
  <style>
    :root{--bg:#0b0c10;--panel:#111218;--muted:#a3a3a3;--text:#eaeaea;--accent:#6ee7ff;--border:#1f2430}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{position:sticky;top:0;background:linear-gradient(180deg,var(--panel),rgba(17,18,24,.95));backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--border);padding:10px 12px;z-index:5}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .title{font-weight:700}
    label{font-size:12px;color:var(--muted)}
    input,select,textarea,button{background:#0f1117;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    input,select{height:40px}
    input[type="password"]{letter-spacing:0.05em}
    button{cursor:pointer}
    button.primary{background:#131a22;border-color:#223;box-shadow:0 0 0 1px rgba(110,231,255,.06) inset}
    button.primary:hover{box-shadow:0 0 0 1px rgba(110,231,255,.2) inset}
    main{max-width:840px;margin:0 auto;padding:12px}
    .bar{display:grid;grid-template-columns:repeat(12,1fr);gap:8px}
    .bar > *{min-width:130px}
    .span3{grid-column:span 3} .span2{grid-column:span 2} .span4{grid-column:span 4} .span6{grid-column:span 6} .span12{grid-column:span 12}
    .chat{display:flex;flex-direction:column;gap:10px;margin:14px 0 90px}
    .msg{display:flex;gap:10px;align-items:flex-start}
    .bubble{padding:10px 12px;border:1px solid var(--border);border-radius:14px;max-width:85%}
    .user .bubble{background:#151a22}
    .assistant .bubble{background:#101418}
    .sys{font-size:12px;color:var(--muted)}
    .inputdock{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(180deg,rgba(11,12,16,.2),var(--panel));border-top:1px solid var(--border);padding:12px}
    .inputrow{max-width:840px;margin:0 auto;display:flex;gap:8px}
    .inputrow input{flex:1}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="row" style="justify-content:space-between">
      <div class="title">💬 Tiny Chat MVP — Lane A</div>
      <div class="row">
        <button id="clearBtn" title="Reset conversation">Clear</button>
      </div>
    </div>
    <div class="bar">
      <div class="span2">
        <label>Mode</label>
        <select id="mode">
          <option>Demo (no key)</option>
          <option>Hugging Face Inference API</option>
        </select>
      </div>
      <div class="span3">
        <label>HF Token (Real mode)</label>
        <input id="token" type="password" placeholder="paste HF_TOKEN here"/>
      </div>
      <div class="span3">
        <label>Model (HF Router id)</label>
        <input id="model" value="openai/gpt-oss-20b" />
      </div>
      <div class="span2">
        <label>Temperature</label>
        <input id="temp" type="number" step="0.1" min="0" max="1.5" value="0.7"/>
      </div>
      <div class="span12">
        <label>System prompt</label>
        <input id="system" value="You are a concise, friendly assistant."/>
      </div>
    </div>
    <div class="small">Tip: In Real mode, the token is only used in this session (not stored). For public demos without secrets, stay in Demo mode.</div>
  </header>

  <main>
    <div class="chat" id="chat"></div>
  </main>

  <div class="inputdock">
    <div class="inputrow">
      <input id="userInput" placeholder="Type a message and press Enter…"/>
      <button class="primary" id="sendBtn">Send</button>
    </div>
  </div>

  <script>
    const el = (q) => document.querySelector(q);
    const chat = el('#chat');
    const modeEl = el('#mode');
    const tokenEl = el('#token');
    const modelEl = el('#model');
    const tempEl  = el('#temp');
    const sysEl   = el('#system');
    const inputEl = el('#userInput');

    let messages = [{ role: "system", content: sysEl.value }];

    function addMessage(role, content){
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (role === 'user' ? 'user' : role === 'assistant' ? 'assistant' : 'system');
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = content;
      wrap.appendChild(bubble);
      chat.appendChild(wrap);
      chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
    }

    function demoReply(text){
      const canned = {
        hello: "Hey! 👋 What would you like to build?",
        hi: "Hi! Ready to prototype something?",
        help: "Tell me your goal in one sentence and I’ll outline next steps.",
        joke: "Why did the developer go broke? They cleared their cache."
      };
      const low = text.trim().toLowerCase();
      for (const k in canned){ if (low.includes(k)) return canned[k]; }
      return `You said: “${text}”. Next action: state your goal + constraints. I’ll suggest a plan.`;
    }

    async function hfChat(messages, model, temperature, token){
      const url = "https://router.huggingface.co/v1/chat/completions";
      const payload = { model, messages, temperature, stream: false };
      const r = await fetch(url, {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });
      if (!r.ok){
        const t = await r.text();
        throw new Error(`HF API error ${r.status}: ${t.slice(0,200)}`);
      }
      const data = await r.json();
      return data.choices?.[0]?.message?.content ?? "(no content)";
    }

    function setSystem(){
      messages[0] = { role: "system", content: sysEl.value };
      // update visible sys note
      const sysNote = document.querySelector('.sysnote');
      if (sysNote) sysNote.textContent = sysEl.value;
    }

    async function send(){
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = "";
      addMessage("user", text);
      messages.push({ role: "user", content: text });

      let reply = "";
      addMessage("assistant", "…");
      const lastBubble = chat.lastElementChild.querySelector('.bubble');

      try{
        if (modeEl.value.startsWith("Demo")){
          await new Promise(r => setTimeout(r, 200));
          reply = demoReply(text);
        } else {
          const token = tokenEl.value.trim();
          if (!token) throw new Error("No HF token provided. Paste your HF token or switch to Demo mode.");
          // messages already includes system/user history
          reply = await hfChat(messages, modelEl.value.trim(), parseFloat(tempEl.value), token);
        }
        lastBubble.textContent = reply;
        messages.push({ role: "assistant", content: reply });
      } catch(err){
        lastBubble.textContent = "⚠️ " + (err?.message || err);
      }
    }

    // UI bindings
    el('#sendBtn').addEventListener('click', send);
    inputEl.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') send(); });
    el('#clearBtn').addEventListener('click', ()=>{
      messages = [{ role: "system", content: sysEl.value }];
      chat.innerHTML = "";
    });
    sysEl.addEventListener('change', setSystem);

    // boot with a friendly note
    const sysNote = document.createElement('div');
    sysNote.className = 'sys';
    sysNote.classList.add('sysnote');
    sysNote.textContent = sysEl.value;
    const sysWrap = document.createElement('div');
    sysWrap.className = 'msg';
    const sysBubble = document.createElement('div');
    sysBubble.className = 'bubble';
    sysBubble.appendChild(sysNote);
    sysWrap.appendChild(sysBubble);
    chat.appendChild(sysWrap);
  </script>
</body>
</html>
