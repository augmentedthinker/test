<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-hit-test@0.0.3/dist/aframe-hit-test.min.js"></script>
    <title>Geometric AR Objects</title>
</head>
<body>
    <a-scene 
        background="color: transparent"
        webxr="requiredFeatures: hit-test,local-floor; optionalFeatures: anchors,plane-detection,depth-sensing,dom-overlay"
        renderer="antialias: true; colorManagement: true"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">

        <a-assets>
            <a-mixin id="cube" 
                     geometry="primitive: box; width: 0.3; height: 0.3; depth: 0.3"
                     material="color: #4CC3D9; metalness: 0.2; roughness: 0.8"
                     animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-mixin>
            <a-mixin id="table-top" 
                     geometry="primitive: box; width: 1.0; height: 0.05; depth: 0.6"
                     material="color: #8B4513; metalness: 0.2; roughness: 0.8"></a-mixin>
            <a-mixin id="table-leg" 
                     geometry="primitive: box; width: 0.08; height: 0.7; depth: 0.08"
                     material="color: #8B4513; metalness: 0.2; roughness: 0.8"></a-mixin>
        </a-assets>

        <!-- Basic A-Frame box -->
        <a-box position="0 1 -3" rotation="0 45 0" color="#4CC3D9"></a-box>

        <!-- Camera -->
        <a-camera position="0 1.6 0"></a-camera>

        <script>
            // Function to create a table object
            function createTable(container) {
                // Table top
                const tableTop = document.createElement('a-entity');
                tableTop.setAttribute('mixin', 'table-top');
                tableTop.setAttribute('position', '0 0.7 0');
                container.appendChild(tableTop);
                
                // Table legs
                const legPositions = [
                    { x: 0.4, z: 0.4 }, { x: -0.4, z: 0.4 },
                    { x: 0.4, z: -0.4 }, { x: -0.4, z: -0.4 }
                ];
                
                legPositions.forEach(pos => {
                    const leg = document.createElement('a-entity');
                    leg.setAttribute('mixin', 'table-leg');
                    leg.setAttribute('position', `${pos.x} 0.35 ${pos.z}`);
                    container.appendChild(leg);
                });
            }

            // Example of how to use the mixin and create a table (you'd typically do this on a hit-test or user interaction)
            // For demonstration, let's add a cube using the mixin and a table when the scene loads
            document.querySelector('a-scene').addEventListener('loaded', function () {
                const scene = this;

                // Add a cube using the mixin
                const cubeFromMixin = document.createElement('a-entity');
                cubeFromMixin.setAttribute('mixin', 'cube');
                cubeFromMixin.setAttribute('position', '-1 1 -5'); // Adjust position as needed
                scene.appendChild(cubeFromMixin);

                // Add a table
                const tableContainer = document.createElement('a-entity');
                tableContainer.setAttribute('position', '1 0 -4'); // Adjust position as needed
                scene.appendChild(tableContainer);
                createTable(tableContainer);
            });

            // WebXR session management and hit-testing (as provided in the document)
            const scene = document.querySelector('a-scene');
            let hitTestSource = null;

            if (navigator.xr) {
                navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
                    if (supported) {
                        console.log('Immersive AR supported');
                        // You would typically have a button to enter AR here
                        // For this example, we'll assume AR mode is entered via A-Frame's default UI or a custom button
                    } else {
                        console.log('Immersive AR not supported');
                    }
                });
            }

            scene.addEventListener('enter-vr', async function() {
                const session = scene.renderer.xr.getSession();
                if (session && session.requestReferenceSpace) {
                    try {
                        const referenceSpace = await session.requestReferenceSpace('viewer');
                        hitTestSource = await session.requestHitTestSource({ space: referenceSpace });
                        console.log('Hit test source created');
                    } catch (error) {
                        console.log('Hit test not supported:', error);
                    }
                }
            });

            scene.addEventListener('exit-vr', () => {
                hitTestSource = null;
                console.log('Exited AR mode');
            });

            // You would typically use hit-test results to place objects dynamically
            // For this example, objects are placed statically on scene load.
        </script>
    </a-scene>
</body>
</html>

